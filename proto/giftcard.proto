syntax = "proto3";

package giftcard;
option go_package = "lazervaultGo/pb";

import "google/protobuf/timestamp.proto";

// ======================
// GIFT CARD SERVICE
// ======================

service GiftCardService {
  // Brand operations
  rpc GetBrands(GetBrandsRequest) returns (GetBrandsResponse);
  rpc GetBrandById(GetBrandByIdRequest) returns (GetBrandByIdResponse);
  rpc SearchBrands(SearchBrandsRequest) returns (SearchBrandsResponse);

  // Gift card operations
  rpc GetUserGiftCards(GetUserGiftCardsRequest) returns (GetUserGiftCardsResponse);
  rpc GetGiftCardById(GetGiftCardByIdRequest) returns (GetGiftCardByIdResponse);

  // Purchase flow
  rpc PurchaseGiftCard(PurchaseGiftCardRequest) returns (PurchaseGiftCardResponse);
  rpc ValidatePurchase(ValidatePurchaseRequest) returns (ValidatePurchaseResponse);

  // Redemption
  rpc ValidateCode(ValidateCodeRequest) returns (ValidateCodeResponse);
  rpc RedeemGiftCard(RedeemGiftCardRequest) returns (RedeemGiftCardResponse);

  // Balance
  rpc CheckBalance(CheckBalanceRequest) returns (CheckBalanceResponse);

  // Transfer
  rpc TransferGiftCard(TransferGiftCardRequest) returns (TransferGiftCardResponse);

  // Sell/Resale
  rpc SellGiftCard(SellGiftCardRequest) returns (SellGiftCardResponse);
  rpc GetResellableCards(GetResellableCardsRequest) returns (GetResellableCardsResponse);

  // Transactions
  rpc GetTransactions(GetTransactionsRequest) returns (GetTransactionsResponse);
  rpc GetTransactionById(GetTransactionByIdRequest) returns (GetTransactionByIdResponse);

  // Statistics
  rpc GetStatistics(GetStatisticsRequest) returns (GetStatisticsResponse);
}

// ======================
// ENUMS
// ======================

enum GiftCardStatus {
  GIFTCARD_STATUS_UNSPECIFIED = 0;
  GIFTCARD_STATUS_ACTIVE = 1;
  GIFTCARD_STATUS_USED = 2;
  GIFTCARD_STATUS_EXPIRED = 3;
  GIFTCARD_STATUS_PENDING = 4;
  GIFTCARD_STATUS_CANCELLED = 5;
  GIFTCARD_STATUS_PARTIALLY_REDEEMED = 6;
}

enum GiftCardType {
  GIFTCARD_TYPE_UNSPECIFIED = 0;
  GIFTCARD_TYPE_DIGITAL = 1;
  GIFTCARD_TYPE_PHYSICAL = 2;
}

enum GiftCardCategory {
  GIFTCARD_CATEGORY_UNSPECIFIED = 0;
  GIFTCARD_CATEGORY_ENTERTAINMENT = 1;
  GIFTCARD_CATEGORY_SHOPPING = 2;
  GIFTCARD_CATEGORY_DINING = 3;
  GIFTCARD_CATEGORY_TRAVEL = 4;
  GIFTCARD_CATEGORY_GAMING = 5;
  GIFTCARD_CATEGORY_OTHER = 6;
}

enum TransactionType {
  TRANSACTION_TYPE_UNSPECIFIED = 0;
  TRANSACTION_TYPE_PURCHASE = 1;
  TRANSACTION_TYPE_REDEEM = 2;
  TRANSACTION_TYPE_TRANSFER = 3;
  TRANSACTION_TYPE_REFUND = 4;
  TRANSACTION_TYPE_SELL = 5;
}

enum PaymentMethod {
  PAYMENT_METHOD_UNSPECIFIED = 0;
  PAYMENT_METHOD_WALLET = 1;
  PAYMENT_METHOD_CARD = 2;
  PAYMENT_METHOD_BANK_TRANSFER = 3;
  PAYMENT_METHOD_MOBILE_MONEY = 4;
  PAYMENT_METHOD_CRYPTO = 5;
}

// ======================
// CORE MESSAGES
// ======================

message GiftCardBrand {
  string id = 1;
  string name = 2;
  string logo_url = 3;
  string description = 4;
  GiftCardCategory category = 5;
  double discount_percentage = 6;
  bool is_popular = 7;
  repeated string available_denominations = 8;
  double min_amount = 9;
  double max_amount = 10;
  string terms_and_conditions = 11;
  bool is_available = 12;
  int32 stock_count = 13;
  google.protobuf.Timestamp created_at = 14;
  google.protobuf.Timestamp updated_at = 15;
}

message GiftCard {
  string id = 1;
  string user_id = 2;
  string brand_id = 3;
  string brand_name = 4;
  string logo_url = 5;
  double amount = 6;
  double discount_percentage = 7;
  double final_price = 8;
  string currency = 9;
  GiftCardStatus status = 10;
  GiftCardType type = 11;
  GiftCardCategory category = 12;
  string description = 13;
  string terms_and_conditions = 14;
  google.protobuf.Timestamp expiry_date = 15;
  google.protobuf.Timestamp purchase_date = 16;
  string recipient_email = 17;
  string recipient_name = 18;
  string message = 19;
  string code = 20;
  string pin = 21;
  bool is_redeemed = 22;
  string transaction_id = 23;
  repeated string available_denominations = 24;
  string qr_code_url = 25;
  string barcode_url = 26;
  google.protobuf.Timestamp created_at = 27;
  google.protobuf.Timestamp updated_at = 28;
  google.protobuf.Timestamp redeemed_at = 29;
  string redemption_location = 30;
  double remaining_balance = 31;
  double original_amount = 32;
}

message GiftCardTransaction {
  string id = 1;
  string gift_card_id = 2;
  string user_id = 3;
  double amount = 4;
  string currency = 5;
  google.protobuf.Timestamp transaction_date = 6;
  TransactionType transaction_type = 7;
  GiftCardStatus status = 8;
  string failure_reason = 9;
  PaymentMethod payment_method = 10;
  string payment_reference = 11;
  string receipt_url = 12;
  string recipient_email = 13;
  string recipient_name = 14;
  google.protobuf.Timestamp created_at = 15;
}

message Statistics {
  int64 total_cards = 1;
  int64 active_cards = 2;
  int64 used_cards = 3;
  int64 pending_cards = 4;
  int64 expired_cards = 5;
  double total_value = 6;
  double total_spent = 7;
  double total_saved = 8;
  repeated GiftCard recent_cards = 9;
  repeated GiftCardTransaction recent_transactions = 10;
}

// ======================
// BRAND REQUESTS/RESPONSES
// ======================

message GetBrandsRequest {
  GiftCardCategory category = 1;
  bool popular_only = 2;
  int32 page = 3;
  int32 limit = 4;
}

message GetBrandsResponse {
  repeated GiftCardBrand brands = 1;
  int64 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message GetBrandByIdRequest {
  string brand_id = 1;
}

message GetBrandByIdResponse {
  GiftCardBrand brand = 1;
}

message SearchBrandsRequest {
  string query = 1;
  GiftCardCategory category = 2;
  int32 page = 3;
  int32 limit = 4;
}

message SearchBrandsResponse {
  repeated GiftCardBrand brands = 1;
  int64 total = 2;
  string query = 3;
}

// ======================
// GIFT CARD REQUESTS/RESPONSES
// ======================

message GetUserGiftCardsRequest {
  GiftCardStatus status = 1;
  GiftCardCategory category = 2;
  string search_query = 3;
  int32 page = 4;
  int32 limit = 5;
}

message GetUserGiftCardsResponse {
  repeated GiftCard gift_cards = 1;
  int64 total = 2;
  Statistics statistics = 3;
}

message GetGiftCardByIdRequest {
  string gift_card_id = 1;
}

message GetGiftCardByIdResponse {
  GiftCard gift_card = 1;
}

// ======================
// PURCHASE REQUESTS/RESPONSES
// ======================

message PurchaseGiftCardRequest {
  string brand_id = 1;
  double amount = 2;
  string currency = 3;
  PaymentMethod payment_method = 4;
  string recipient_email = 5;
  string recipient_name = 6;
  string message = 7;
  bool is_for_self = 8;
  google.protobuf.Timestamp scheduled_delivery = 9;
}

message PurchaseGiftCardResponse {
  GiftCard gift_card = 1;
  string receipt_url = 2;
  string transaction_id = 3;
  string message = 4;
}

message ValidatePurchaseRequest {
  string brand_id = 1;
  double amount = 2;
  PaymentMethod payment_method = 3;
}

message ValidatePurchaseResponse {
  bool is_valid = 1;
  string message = 2;
  double discount_applied = 3;
  double final_price = 4;
}

// ======================
// REDEMPTION REQUESTS/RESPONSES
// ======================

message ValidateCodeRequest {
  string code = 1;
  string pin = 2;
}

message ValidateCodeResponse {
  bool is_valid = 1;
  bool is_expired = 2;
  bool is_redeemed = 3;
  GiftCard gift_card = 4;
  string message = 5;
}

message RedeemGiftCardRequest {
  string gift_card_id = 1;
  string code = 2;
  string pin = 3;
  double amount_to_redeem = 4;
  string location = 5;
}

message RedeemGiftCardResponse {
  GiftCard gift_card = 1;
  double redeemed_amount = 2;
  double remaining_balance = 3;
  string receipt_url = 4;
  string message = 5;
}

message CheckBalanceRequest {
  string gift_card_id = 1;
  string code = 2;
  string pin = 3;
}

message CheckBalanceResponse {
  double remaining_balance = 1;
  double original_amount = 2;
  double redeemed_amount = 3;
  google.protobuf.Timestamp last_used = 4;
  GiftCard gift_card = 5;
}

// ======================
// TRANSFER REQUESTS/RESPONSES
// ======================

message TransferGiftCardRequest {
  string gift_card_id = 1;
  string recipient_email = 2;
  string recipient_name = 3;
  string message = 4;
}

message TransferGiftCardResponse {
  GiftCard gift_card = 1;
  string message = 2;
}

// ======================
// SELL/RESALE REQUESTS/RESPONSES
// ======================

message SellGiftCardRequest {
  string gift_card_id = 1;
  double asking_price = 2;
  string description = 3;
}

message SellGiftCardResponse {
  string listing_id = 1;
  string message = 2;
}

message GetResellableCardsRequest {
  int32 page = 1;
  int32 limit = 2;
}

message GetResellableCardsResponse {
  repeated GiftCard gift_cards = 1;
  int64 total = 2;
}

// ======================
// TRANSACTION REQUESTS/RESPONSES
// ======================

message GetTransactionsRequest {
  TransactionType transaction_type = 1;
  google.protobuf.Timestamp start_date = 2;
  google.protobuf.Timestamp end_date = 3;
  int32 page = 4;
  int32 limit = 5;
}

message GetTransactionsResponse {
  repeated GiftCardTransaction transactions = 1;
  int64 total = 2;
}

message GetTransactionByIdRequest {
  string transaction_id = 1;
}

message GetTransactionByIdResponse {
  GiftCardTransaction transaction = 1;
}

// ======================
// STATISTICS REQUESTS/RESPONSES
// ======================

message GetStatisticsRequest {
  // Empty - gets stats for current user
}

message GetStatisticsResponse {
  Statistics statistics = 1;
}
