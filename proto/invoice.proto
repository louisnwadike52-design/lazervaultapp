syntax = "proto3";

package pb;

import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

option go_package = "lazervaultGo/pb";

// --- OpenAPI Definitions ---
option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
	info: {
		title: "LazerVault Invoice Service";
		version: "1.0";
		contact: {
			name: "LazerVault";
			url: "https://github.com/LazerVault";
		};
	};
  // Define responses map using standard text format for maps
  responses: { key: "400", value: {description: "Invalid request parameters."} }
  responses: { key: "401", value: {description: "Authentication required."} }
  responses: { key: "404", value: {description: "Resource not found."} }
  responses: { key: "500", value: {description: "Internal server error."} }
};

// --- Messages ---

// Represents customer details associated with an invoice
message CustomerDetails {
  string name = 1;
  string email = 2;        // Optional
  string address = 3;      // Optional
  // string phone_number = 4; // Optional
}

// Represents a single line item in an invoice
message InvoiceItem {
  string item_id = 1;      // Optional: ID if linked to a product catalog
  string description = 2;
  int32 quantity = 3;
  double unit_price = 4;
  double total_price = 5; // quantity * unit_price (calculated or provided)
}

// Enum for invoice status
enum InvoiceStatus {
  DRAFT = 0;
  SENT = 1;
  PAID = 2;
  VOID = 3;
  OVERDUE = 4;
}

// Represents an invoice
message Invoice {
  string invoice_id = 1;
  string user_id = 2;           // ID of the user/business issuing the invoice
  string invoice_number = 3;    // User-friendly invoice number (e.g., INV-001)
  CustomerDetails customer_details = 4;
  repeated InvoiceItem items = 5;
  double subtotal = 6;          // Sum of item totals
  double tax = 7;               // Optional tax amount
  double total_amount = 8;      // subtotal + tax
  string currency_code = 9;     // e.g., USD, GBP
  google.protobuf.Timestamp issue_date = 10;
  google.protobuf.Timestamp due_date = 11;
  InvoiceStatus status = 12;
  string notes = 13;            // Optional notes
  google.protobuf.Timestamp created_at = 14;
  google.protobuf.Timestamp updated_at = 15;
  // google.protobuf.Timestamp paid_date = 16; // Optional
}

// Request to create a new invoice
message CreateInvoiceRequest {
  option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
		json_schema: {
			title: "Create Invoice Request";
			description: "Payload to create a new invoice.";
			required: ["customer_details", "items", "currency_code", "due_date"];
		}
	};
  // invoice_number can be auto-generated or provided
  // string invoice_number = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Optional custom invoice number."}];
  CustomerDetails customer_details = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Details of the customer being invoiced."}];
  repeated InvoiceItem items = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Line items for the invoice."}];
  double tax = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Optional tax amount."}];
  string currency_code = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "3-letter currency code (e.g., USD)."}];
  google.protobuf.Timestamp due_date = 6 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Payment due date."}];
  string notes = 7 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Optional notes or terms."}];
  // Status usually starts as DRAFT or SENT
}

// Response after creating an invoice
message CreateInvoiceResponse {
   option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
		json_schema: {
			title: "Create Invoice Response";
			description: "Contains the details of the newly created invoice.";
		}
	};
  Invoice invoice = 1;
}

// Request to get a specific invoice
message GetInvoiceRequest {
   option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
		json_schema: {
			title: "Get Invoice Request";
			description: "Payload to retrieve a specific invoice by its ID.";
			required: ["invoice_id"];
		}
	};
  string invoice_id = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "The unique ID of the invoice to retrieve."}];
}

// Response containing a single invoice
// Uses the Invoice message directly

// Request to list invoices for the authenticated user
message ListInvoicesRequest {
   option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
		json_schema: {
			title: "List Invoices Request";
			description: "Payload to retrieve a list of invoices, with optional filtering and pagination.";
		}
	};
  int32 page_size = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Number of invoices per page. Default: 20."}];
  string page_token = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Token for fetching the next page. Optional."}];
  InvoiceStatus status_filter = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Optional filter by invoice status."}]; // Optional filter
}

// Response containing a list of invoices
message ListInvoicesResponse {
   option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
		json_schema: {
			title: "List Invoices Response";
			description: "Contains a list of invoices and pagination info.";
		}
	};
  repeated Invoice invoices = 1;
  string next_page_token = 2;
}

// --- Service Definition ---
service InvoiceService {

  // Create a new invoice
  rpc CreateInvoice (CreateInvoiceRequest) returns (CreateInvoiceResponse) {
    option (google.api.http) = {
      post: "/v1/invoices"
      body: "*"
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
			description: "Creates a new invoice for the authenticated user.";
			summary: "Create Invoice";
            tags: ["Invoice"];
            responses: {
                key: "200"; value: {
                    description: "Invoice Created Successfully"; schema: { json_schema: { ref: "#/definitions/pbCreateInvoiceResponse"; }}
                }
            }
		};
  }

  // Get a specific invoice by ID
  rpc GetInvoice (GetInvoiceRequest) returns (Invoice) {
    option (google.api.http) = {
      get: "/v1/invoices/{invoice_id}"
    };
     option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
			description: "Retrieves the details of a specific invoice by its ID.";
			summary: "Get Invoice";
            tags: ["Invoice"];
            responses: {
                key: "200"; value: {
                    description: "OK"; schema: { json_schema: { ref: "#/definitions/pbInvoice"; }}
                }
            }
		};
  }

  // List invoices for the authenticated user
  rpc ListInvoices (ListInvoicesRequest) returns (ListInvoicesResponse) {
    option (google.api.http) = {
      get: "/v1/invoices"
      // Query parameters mapped automatically
    };
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
			description: "Retrieves a paginated list of invoices for the authenticated user, optionally filtered by status.";
			summary: "List Invoices";
            tags: ["Invoice"];
             responses: {
                key: "200"; value: {
                    description: "OK"; schema: { json_schema: { ref: "#/definitions/pbListInvoicesResponse"; }}
                }
            }
		};
  }

  // Add UpdateInvoiceStatus, DeleteInvoice etc. later if needed
} 