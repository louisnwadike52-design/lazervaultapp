syntax = "proto3";

package invoice;

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

option go_package = "invoice-service/proto";

// Invoice Service - Invoice creation and payment management
service InvoiceService {
  // === INVOICE OPERATIONS ===

  // Create a new invoice (invoice from AppServiceName)
  rpc CreateInvoice(CreateInvoiceRequest) returns (CreateInvoiceResponse) {
    option (google.api.http) = {
      post: "/api/v1/invoices/createinvoice"
      body: "*"
    };
  }

  // Get all invoices for a user
  rpc GetInvoices(GetInvoicesRequest) returns (GetInvoicesResponse) {
    option (google.api.http) = {
      get: "/api/v1/invoices/invoices"
    };
  }

  // Get a specific invoice
  rpc GetInvoice(GetInvoiceRequest) returns (GetInvoiceResponse) {
    option (google.api.http) = {
      get: "/api/v1/invoices/invoice"
    };
  }

  // Pay an invoice (payInvoice from AppServiceName)
  rpc PayInvoice(PayInvoiceRequest) returns (PayInvoiceResponse) {
    option (google.api.http) = {
      post: "/api/v1/invoices/payinvoice"
      body: "*"
    };
  }

  // Cancel an invoice
  rpc CancelInvoice(CancelInvoiceRequest) returns (CancelInvoiceResponse) {
    option (google.api.http) = {
      post: "/api/v1/invoices/cancelinvoice"
      body: "*"
    };
  }

  // Send invoice reminder
  rpc SendInvoiceReminder(SendInvoiceReminderRequest) returns (SendInvoiceReminderResponse) {
    option (google.api.http) = {
      post: "/api/v1/invoices/sendinvoicereminder"
      body: "*"
    };
  }

  // Update invoice status
  rpc UpdateInvoiceStatus(UpdateInvoiceStatusRequest) returns (UpdateInvoiceStatusResponse) {
    option (google.api.http) = {
      put: "/api/v1/invoices/invoicestatus"
      body: "*"
    };
  }
}

// ===== MODELS =====

message Invoice {
  string id = 1;
  string user_id = 2;                   // Invoice creator
  string account_id = 3;                // Account to receive payment
  string invoice_number = 4;            // Unique invoice number
  string recipient_email = 5;           // Who to send invoice to
  string recipient_name = 6;
  double amount = 7;
  string currency = 8;
  string status = 9;                    // "pending", "paid", "cancelled", "overdue"
  string description = 10;
  string due_date = 11;
  repeated InvoiceItem items = 12;
  double tax = 13;
  double discount = 14;
  double total_amount = 15;
  string payment_reference = 16;        // Reference after payment
  string paid_at = 17;
  string notes = 18;
  string metadata = 19;                 // JSON metadata
  string created_at = 20;
  string updated_at = 21;
}

message InvoiceItem {
  string description = 1;
  int32 quantity = 2;
  double unit_price = 3;
  double total = 4;
}

// ===== CREATE INVOICE =====
// NOTE: user_id extracted from JWT token, not from request
message CreateInvoiceRequest {
  string account_id = 1;                // Account to receive payment
  string recipient_email = 2;
  string recipient_name = 3;
  double amount = 4;
  string description = 5;
  string due_date = 6;
  repeated InvoiceItem items = 7;
  double tax = 8;
  double discount = 9;
  string notes = 10;
}

message CreateInvoiceResponse {
  Invoice invoice = 1;
  string message = 2;
}

// ===== GET INVOICES =====
// NOTE: user_id extracted from JWT token, not from request
message GetInvoicesRequest {
  string account_id = 1;                // Optional filter
  string status = 2;                    // Optional filter
  string start_date = 3;
  string end_date = 4;
  int32 limit = 5;
  int32 offset = 6;
}

message GetInvoicesResponse {
  repeated Invoice invoices = 1;
  int32 total = 2;
  double total_amount_pending = 3;
  double total_amount_paid = 4;
}

// ===== GET INVOICE =====
// NOTE: user_id extracted from JWT token, not from request
message GetInvoiceRequest {
  string invoice_id = 1;
}

message GetInvoiceResponse {
  Invoice invoice = 1;
}

// ===== PAY INVOICE =====
// NOTE: user_id extracted from JWT token, not from request
message PayInvoiceRequest {
  string invoice_id = 1;
  string account_id = 2;                // Account to debit from
  string pin = 3;                       // Security PIN
}

message PayInvoiceResponse {
  Invoice invoice = 1;
  double new_balance = 2;
  string payment_reference = 3;
  string message = 4;
}

// ===== CANCEL INVOICE =====
// NOTE: user_id extracted from JWT token, not from request
message CancelInvoiceRequest {
  string invoice_id = 1;
  string reason = 2;
}

message CancelInvoiceResponse {
  Invoice invoice = 1;
  string message = 2;
}

// ===== SEND INVOICE REMINDER =====
// NOTE: user_id extracted from JWT token, not from request
message SendInvoiceReminderRequest {
  string invoice_id = 1;
}

message SendInvoiceReminderResponse {
  bool sent = 1;
  string message = 2;
}

// ===== UPDATE INVOICE STATUS =====
// NOTE: user_id extracted from JWT token, not from request
message UpdateInvoiceStatusRequest {
  string invoice_id = 1;
  string status = 2;                    // "pending", "paid", "cancelled", "overdue"
}

message UpdateInvoiceStatusResponse {
  Invoice invoice = 1;
  string message = 2;
}
