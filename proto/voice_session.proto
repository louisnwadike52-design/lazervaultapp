syntax = "proto3";

package pb;

import "google/api/annotations.proto";
import "protoc-gen-openapiv2/options/annotations.proto";

option go_package = "lazervaultGo/pb";

option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_swagger) = {
    info: {
        title: "LazerVault API";
        version: "1.0";
        description: "LazerVault Voice Session API";
    };
    schemes: HTTP;
    schemes: HTTPS;
    consumes: "application/json";
    produces: "application/json";
};

message StartVoiceSessionRequest {
    // Service name for routing to specific voice agent (e.g., "stocks", "transfers", "crypto")
    string service_name = 1;

    // Preferred language for the voice agent (optional)
    string preferred_agent_language = 2;
}

message StartVoiceSessionResponse {
    string room_name = 1;         // The unique LiveKit room name for this session.
    string livekit_token = 2;     // The LiveKit access token for the Flutter client.
    string agent_id = 3;          // An identifier for the agent (optional, could be fixed).
    string agent_url = 4;         // The URL/address of the voice agent service for this session.
    int32 agent_port = 5;         // The port number of the voice agent service.
}

// Voice note processing request - accepts multipart form data file upload
message ProcessVoiceNoteRequest {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
        json_schema: {
            title: "Process Voice Note Request";
            description: "Request to process an audio file via multipart form upload.";
        }
    };
    
    string tx_history = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Optional JSON string containing recent transactions."}];
}

// Voice note processing response
message ProcessVoiceNoteResponse {
    option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_schema) = {
        json_schema: {
            title: "Process Voice Note Response";
            description: "Response containing AI analysis and transcription of the voice note.";
        }
    };
    
    bool success = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Indicates if the voice note was successfully processed."}];
    string msg = 2 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Status message related to the processing."}];
    string response = 3 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "AI's response based on the voice note content."}];
    string transcribed_text = 4 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Transcribed text from the audio file."}];
    int64 processing_time_ms = 5 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {description: "Processing time in milliseconds."}];
}

service VoiceSessionService {
    // Starts a new voice session by creating a LiveKit room,
    // generating a token for the client, and dispatching an agent.
    rpc StartVoiceSession(StartVoiceSessionRequest) returns (StartVoiceSessionResponse) {
        option (google.api.http) = {
            post: "/v1/voice/session/start" // POST request to start a session
            body: "*"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Start Voice Session";
            description: "Initiates a voice session with an AI agent, returns LiveKit room details and client token.";
            tags: ["Voice Session"];
            security: {
              security_requirement: {
                key: "bearer"
              }
            }
        };
    }

    // Processes a voice note and returns AI response with transcription
    rpc ProcessVoiceNote(ProcessVoiceNoteRequest) returns (ProcessVoiceNoteResponse) {
        option (google.api.http) = {
            post: "/v1/voice/note/upload"
            body: "*"
        };
        option (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_operation) = {
            summary: "Process Voice Note";
            description: "Upload and process an audio file via multipart form data. File should be uploaded as 'audio_file' field.";
            tags: ["Voice Note"];
            security: {
              security_requirement: {
                key: "bearer"
              }
            }
        };
    }
} 