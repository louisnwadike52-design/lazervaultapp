syntax = "proto3";

package pb;
option go_package = "lazervaultGo/pb";

import "google/api/annotations.proto";

// Inline pagination to avoid cross-proto package dependency
message InsurancePaginationInfo {
    int32 current_page = 1;
    int32 total_pages = 2;
    int32 total_items = 3;
    int32 items_per_page = 4;
    bool has_next = 5;
    bool has_prev = 6;
}

// Insurance Policy Management
message GetUserInsurancesRequest {
    int32 page = 1;
    int32 limit = 2;
}

message GetUserInsurancesResponse {
    repeated Insurance insurances = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

message GetInsuranceByIdRequest {
    string id = 1;
}

message GetInsuranceByIdResponse {
    Insurance insurance = 1;
    bool success = 2;
    string msg = 3;
}

message CreateInsuranceRequest {
    Insurance insurance = 1;
}

message CreateInsuranceResponse {
    Insurance insurance = 1;
    bool success = 2;
    string msg = 3;
}

message UpdateInsuranceRequest {
    Insurance insurance = 1;
}

message UpdateInsuranceResponse {
    Insurance insurance = 1;
    bool success = 2;
    string msg = 3;
}

message DeleteInsuranceRequest {
    string id = 1;
}

message DeleteInsuranceResponse {
    bool success = 1;
    string msg = 2;
}

message SearchInsurancesRequest {
    string query = 1;
    int32 page = 2;
    int32 limit = 3;
}

message SearchInsurancesResponse {
    repeated Insurance insurances = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

// Payment Management
message GetInsurancePaymentsRequest {
    string insurance_id = 1;
    int32 page = 2;
    int32 limit = 3;
}

message GetInsurancePaymentsResponse {
    repeated InsurancePayment payments = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

message GetUserPaymentsRequest {
    int32 page = 1;
    int32 limit = 2;
}

message GetUserPaymentsResponse {
    repeated InsurancePayment payments = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

message CreatePaymentRequest {
    InsurancePayment payment = 1;
}

message CreatePaymentResponse {
    InsurancePayment payment = 1;
    bool success = 2;
    string msg = 3;
}

message ProcessPaymentRequest {
    string payment_id = 1;
    string payment_method = 2;
    map<string, string> payment_details = 3;
}

message ProcessPaymentResponse {
    InsurancePayment payment = 1;
    string transaction_id = 2;
    string reference_number = 3;
    string receipt_url = 4;
    bool success = 5;
    string msg = 6;
}

message GetPaymentByIdRequest {
    string id = 1;
}

message GetPaymentByIdResponse {
    InsurancePayment payment = 1;
    bool success = 2;
    string msg = 3;
}

message GetOverduePaymentsRequest {}

message GetOverduePaymentsResponse {
    repeated InsurancePayment payments = 1;
    bool success = 2;
    string msg = 3;
}

// Claims Management
message GetInsuranceClaimsRequest {
    string insurance_id = 1;
    int32 page = 2;
    int32 limit = 3;
}

message GetInsuranceClaimsResponse {
    repeated InsuranceClaim claims = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

message GetUserClaimsRequest {
    int32 page = 1;
    int32 limit = 2;
}

message GetUserClaimsResponse {
    repeated InsuranceClaim claims = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

message CreateClaimRequest {
    InsuranceClaim claim = 1;
}

message CreateClaimResponse {
    InsuranceClaim claim = 1;
    bool success = 2;
    string msg = 3;
}

message UpdateClaimRequest {
    InsuranceClaim claim = 1;
}

message UpdateClaimResponse {
    InsuranceClaim claim = 1;
    bool success = 2;
    string msg = 3;
}

message GetClaimByIdRequest {
    string id = 1;
}

message GetClaimByIdResponse {
    InsuranceClaim claim = 1;
    bool success = 2;
    string msg = 3;
}

// Receipt Management
message GeneratePaymentReceiptRequest {
    string payment_id = 1;
}

message GeneratePaymentReceiptResponse {
    string receipt_url = 1;
    string receipt_id = 2;
    bool success = 3;
    string msg = 4;
}

message GetUserReceiptsRequest {
    int32 page = 1;
    int32 limit = 2;
}

message GetUserReceiptsResponse {
    repeated string receipt_urls = 1;
    InsurancePaginationInfo pagination = 2;
    bool success = 3;
    string msg = 4;
}

// Statistics
message GetInsuranceStatisticsRequest {}

message GetInsuranceStatisticsResponse {
    int32 total_policies = 1;
    int32 active_policies = 2;
    int32 expired_policies = 3;
    double total_coverage_amount = 4;
    double total_premium_amount = 5;
    map<string, int32> policies_by_type = 6;
    bool success = 7;
    string msg = 8;
}

message GetPaymentStatisticsRequest {
    string start_date = 1;
    string end_date = 2;
}

message GetPaymentStatisticsResponse {
    int32 total_payments = 1;
    int32 completed_payments = 2;
    int32 pending_payments = 3;
    int32 failed_payments = 4;
    double total_amount = 5;
    double completed_amount = 6;
    map<string, int32> payments_by_method = 7;
    bool success = 8;
    string msg = 9;
}

// ===== MYCOVER.AI INSURANCE MARKETPLACE =====

// MyCover.ai product form field definition for dynamic forms
message InsuranceProductFormField {
    string name = 1;                         // Field identifier
    string label = 2;                        // Display label
    string type = 3;                         // "text", "number", "date", "select", "boolean", "email", "phone"
    bool required = 4;
    repeated string options = 5;             // For "select" type fields
    string default_value = 6;
    string validation_regex = 7;
    string placeholder = 8;
    string description = 9;                  // Help text for the field
}

// MyCover.ai insurance product
message InsuranceProduct {
    string id = 1;
    string name = 2;
    string description = 3;
    string category = 4;                     // "auto", "health", "travel", "gadget", "home", "life", "package", "content"
    string provider_name = 5;
    string provider_logo = 6;
    double min_premium = 7;                  // User-facing price (includes margin)
    double max_premium = 8;                  // User-facing price (includes margin)
    string currency = 9;
    repeated string benefits = 10;
    string terms_url = 11;
    map<string, string> metadata = 12;
    repeated InsuranceProductFormField form_fields = 13;
    bool is_active = 14;
    string purchase_route = 15;              // Provider-specific route: "leadway/buy-third-party"
    string provider_id = 16;                // MyCover provider UUID
    double base_price = 17;                 // Original MyCover price before margin
    string how_it_works = 18;               // HTML how-it-works text
    string full_benefits = 19;              // HTML benefits text
    bool is_renewable = 20;
    bool is_claimable = 21;
}

// Insurance category metadata
message InsuranceCategory {
    string id = 1;
    string name = 2;
    string icon = 3;
    string description = 4;
    int32 product_count = 5;
}

// Quote result from MyCover.ai
message InsuranceQuote {
    string quote_id = 1;
    string product_id = 2;
    double premium = 3;
    string currency = 4;
    string coverage_summary = 5;
    repeated string coverage_items = 6;
    string valid_until = 7;                  // ISO8601 timestamp
    map<string, string> quote_details = 8;   // Additional quote metadata
}

// Purchase result
message InsurancePurchaseResult {
    string policy_id = 1;
    string policy_number = 2;
    string reference = 3;
    string status = 4;                       // "completed", "pending", "failed"
    string provider_reference = 5;
    Insurance insurance = 6;                 // The created insurance policy
}

// ===== MYCOVER.AI REQUEST/RESPONSE MESSAGES =====

message GetInsuranceProductsRequest {
    string category = 1;                     // Filter by category
    string locale = 2;                       // User locale (e.g., "NG", "US", "GB")
    int32 page = 3;
    int32 limit = 4;
}

message GetInsuranceProductsResponse {
    repeated InsuranceProduct products = 1;
    int32 total = 2;
    bool success = 3;
    string msg = 4;
}

message GetInsuranceCategoriesRequest {
    string locale = 1;
}

message GetInsuranceCategoriesResponse {
    repeated InsuranceCategory categories = 1;
    bool success = 2;
    string msg = 3;
}

message GetInsuranceQuoteRequest {
    string product_id = 1;
    map<string, string> form_data = 2;       // Filled form fields
    string locale = 3;
}

message GetInsuranceQuoteResponse {
    InsuranceQuote quote = 1;
    bool success = 2;
    string msg = 3;
}

message PurchaseInsuranceRequest {
    string quote_id = 1;
    string product_id = 2;
    string account_id = 3;                   // LazerVault account to debit
    string transaction_pin = 4;              // Pre-validated PIN token
    string idempotency_key = 5;
    map<string, string> form_data = 6;       // Customer form data
    string locale = 7;
}

message PurchaseInsuranceResponse {
    InsurancePurchaseResult result = 1;
    bool success = 2;
    string msg = 3;
}

message GetInsurancePurchaseStatusRequest {
    string reference = 1;
}

message GetInsurancePurchaseStatusResponse {
    InsurancePurchaseResult result = 1;
    bool success = 2;
    string msg = 3;
}

// Upload insurance document (ID, proof of purchase, claim evidence, device photo)
message UploadInsuranceDocumentRequest {
    bytes file_data = 1;
    string filename = 2;
    string document_type = 3;                // "id_document", "proof_of_purchase", "claim_evidence", "device_photo"
}

message UploadInsuranceDocumentResponse {
    string upload_id = 1;
    string file_url = 2;
    bool success = 3;
    string msg = 4;
}

// Get auxiliary data (states, vehicle makes/models, genders, etc.)
message GetInsuranceAuxiliaryDataRequest {
    string utility_id = 1;                   // UUID of the utility endpoint
    string query = 2;                        // Optional query param (e.g., vehicle make for models)
}

message GetInsuranceAuxiliaryDataResponse {
    repeated InsuranceAuxiliaryItem items = 1;
    bool success = 2;
    string msg = 3;
}

message InsuranceAuxiliaryItem {
    string label = 1;
    string value = 2;
}

// Data Models
message Insurance {
    string id = 1;
    string policy_number = 2;
    string policy_holder_name = 3;
    string policy_holder_email = 4;
    string policy_holder_phone = 5;
    string type = 6;
    string provider = 7;
    string provider_logo = 8;
    double premium_amount = 9;
    double coverage_amount = 10;
    string currency = 11;
    string start_date = 12;
    string end_date = 13;
    string next_payment_date = 14;
    string status = 15;
    repeated string beneficiaries = 16;
    map<string, string> coverage_details = 17;
    string description = 18;
    string user_id = 19;
    string created_at = 20;
    string updated_at = 21;
}

message InsurancePayment {
    string id = 1;
    string insurance_id = 2;
    string policy_number = 3;
    double amount = 4;
    string currency = 5;
    string payment_method = 6;
    string status = 7;
    string transaction_id = 8;
    string reference_number = 9;
    string payment_date = 10;
    string due_date = 11;
    string processed_at = 12;
    map<string, string> payment_details = 13;
    string failure_reason = 14;
    string receipt_url = 15;
    string user_id = 16;
    string created_at = 17;
    string updated_at = 18;
}

message InsuranceClaim {
    string id = 1;
    string claim_number = 2;
    string insurance_id = 3;
    string policy_number = 4;
    string type = 5;
    string status = 6;
    string title = 7;
    string description = 8;
    double claim_amount = 9;
    double approved_amount = 10;
    string currency = 11;
    string incident_date = 12;
    string incident_location = 13;
    repeated string attachments = 14;
    repeated string documents = 15;
    map<string, string> additional_info = 16;
    string rejection_reason = 17;
    string settlement_date = 18;
    string settlement_details = 19;
    string user_id = 20;
    string created_at = 21;
    string updated_at = 22;
}

// Service Definition
service InsuranceService {
    // Insurance Policy Management
    rpc GetUserInsurances(GetUserInsurancesRequest) returns (GetUserInsurancesResponse) {
        option (google.api.http) = {
            get: "/v1/insurance"
        };
    }

    rpc GetInsuranceById(GetInsuranceByIdRequest) returns (GetInsuranceByIdResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/{id}"
        };
    }

    rpc CreateInsurance(CreateInsuranceRequest) returns (CreateInsuranceResponse) {
        option (google.api.http) = {
            post: "/v1/insurance"
            body: "*"
        };
    }

    rpc UpdateInsurance(UpdateInsuranceRequest) returns (UpdateInsuranceResponse) {
        option (google.api.http) = {
            put: "/v1/insurance"
            body: "*"
        };
    }

    rpc DeleteInsurance(DeleteInsuranceRequest) returns (DeleteInsuranceResponse) {
        option (google.api.http) = {
            delete: "/v1/insurance/{id}"
        };
    }

    rpc SearchInsurances(SearchInsurancesRequest) returns (SearchInsurancesResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/search"
        };
    }

    // Payment Management
    rpc GetInsurancePayments(GetInsurancePaymentsRequest) returns (GetInsurancePaymentsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/{insurance_id}/payments"
        };
    }

    rpc GetUserPayments(GetUserPaymentsRequest) returns (GetUserPaymentsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/payments"
        };
    }

    rpc CreatePayment(CreatePaymentRequest) returns (CreatePaymentResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/payments"
            body: "*"
        };
    }

    rpc ProcessPayment(ProcessPaymentRequest) returns (ProcessPaymentResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/payments/{payment_id}/process"
            body: "*"
        };
    }

    rpc GetPaymentById(GetPaymentByIdRequest) returns (GetPaymentByIdResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/payments/{id}"
        };
    }

    rpc GetOverduePayments(GetOverduePaymentsRequest) returns (GetOverduePaymentsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/payments/overdue"
        };
    }

    // Claims Management
    rpc GetInsuranceClaims(GetInsuranceClaimsRequest) returns (GetInsuranceClaimsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/{insurance_id}/claims"
        };
    }

    rpc GetUserClaims(GetUserClaimsRequest) returns (GetUserClaimsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/claims"
        };
    }

    rpc CreateClaim(CreateClaimRequest) returns (CreateClaimResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/claims"
            body: "*"
        };
    }

    rpc UpdateClaim(UpdateClaimRequest) returns (UpdateClaimResponse) {
        option (google.api.http) = {
            put: "/v1/insurance/claims"
            body: "*"
        };
    }

    rpc GetClaimById(GetClaimByIdRequest) returns (GetClaimByIdResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/claims/{id}"
        };
    }

    // Receipt Management
    rpc GeneratePaymentReceipt(GeneratePaymentReceiptRequest) returns (GeneratePaymentReceiptResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/payments/{payment_id}/receipt"
        };
    }

    rpc GetUserReceipts(GetUserReceiptsRequest) returns (GetUserReceiptsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/receipts"
        };
    }

    // Statistics
    rpc GetInsuranceStatistics(GetInsuranceStatisticsRequest) returns (GetInsuranceStatisticsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/statistics"
        };
    }

    rpc GetPaymentStatistics(GetPaymentStatisticsRequest) returns (GetPaymentStatisticsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/payments/statistics"
        };
    }

    // ===== MyCover.ai Insurance Marketplace =====

    rpc GetInsuranceProducts(GetInsuranceProductsRequest) returns (GetInsuranceProductsResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/products"
        };
    }

    rpc GetInsuranceCategories(GetInsuranceCategoriesRequest) returns (GetInsuranceCategoriesResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/categories"
        };
    }

    rpc GetInsuranceQuote(GetInsuranceQuoteRequest) returns (GetInsuranceQuoteResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/quote"
            body: "*"
        };
    }

    rpc PurchaseInsurance(PurchaseInsuranceRequest) returns (PurchaseInsuranceResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/purchase"
            body: "*"
        };
    }

    rpc GetInsurancePurchaseStatus(GetInsurancePurchaseStatusRequest) returns (GetInsurancePurchaseStatusResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/purchase/{reference}/status"
        };
    }

    // Upload file for insurance documents
    rpc UploadInsuranceDocument(UploadInsuranceDocumentRequest) returns (UploadInsuranceDocumentResponse) {
        option (google.api.http) = {
            post: "/v1/insurance/upload-document"
            body: "*"
        };
    }

    // Get auxiliary data (states, vehicle makes, vehicle models, genders, etc.)
    rpc GetInsuranceAuxiliaryData(GetInsuranceAuxiliaryDataRequest) returns (GetInsuranceAuxiliaryDataResponse) {
        option (google.api.http) = {
            get: "/v1/insurance/auxiliary/{utility_id}"
        };
    }
}
